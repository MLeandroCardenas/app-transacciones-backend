CREATE TABLE TARJETAS (
                          ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                          PAN NUMBER(19) NOT NULL,
                          TITULAR VARCHAR2(100 CHAR) NOT NULL,
                          CEDULA VARCHAR2(15 CHAR) NOT NULL,
                          TIPO VARCHAR2(1 CHAR) CHECK (TIPO IN ('C', 'D')),
                          TELEFONO NUMBER(10),
                          ESTADO VARCHAR2(20 CHAR),
                          NUMERO_VALIDACION NUMBER(3),
                          IDENTIFICADOR VARCHAR2(64 CHAR),
                          CONSTRAINT TARJETAS_UK_PAN UNIQUE (PAN)
);
/
CREATE INDEX IDX_TARJETAS_IDENTIFICADOR ON TARJETAS (IDENTIFICADOR);
/
CREATE TABLE TRANSACCIONES (
    ID                  NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    IDENTIFICADOR       VARCHAR2(64 CHAR)       NOT NULL,
    NUMERO_REFERENCIA   VARCHAR2(6 CHAR)        NOT NULL,
    TOTAL_COMPRA        NUMBER(20,2)            NOT NULL,
    DIRECCION_COMPRA    VARCHAR2(100 CHAR),
    ESTADO_TRANSACCION  VARCHAR2(20 CHAR)       CHECK (ESTADO_TRANSACCION IN ('Aprobada', 'Rechazada', 'Anulada')),
    FECHA_TRANSACCION   TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
    FECHA_ANULACION     TIMESTAMP NULL
);
/
ALTER TABLE TRANSACCIONES
ADD MOTIVO VARCHAR2(50 CHAR);
/
ALTER TABLE TRANSACCIONES
ADD CONSTRAINT UQ_TRANSACCIONES_NUM_REF UNIQUE (NUMERO_REFERENCIA);